From 9184779f8acf1b04201ed39f57bd1e275f7109c4 Mon Sep 17 00:00:00 2001
From: GarethBouwer <itservices@bouwerandco.com>
Date: Wed, 4 Feb 2026 12:17:10 +0200
Subject: [PATCH 20/33] aadadadda

---
 Dockerfile | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/Dockerfile b/Dockerfile
index 59735bdc48a..d604d2ed393 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -17,7 +17,6 @@ RUN apt-get update && apt-get install -y \
     libonig-dev \
     libpq-dev \
     libldap2-dev \
-    composer \
  && docker-php-ext-configure gd --with-freetype --with-jpeg \
  && docker-php-ext-install \
         gd \
@@ -38,15 +37,17 @@ WORKDIR /var/www/html
 # Copy Moodle source
 COPY . /var/www/html
 
-# Install Composer dependencies for Moodle (5.1+ requirement)
-# docs: composer install --no-dev --classmap-authoritative in Moodle root
-RUN composer install --no-dev --classmap-authoritative --no-interaction --prefer-dist
+# Install Composer (official installer) and Moodle vendor deps
+RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" \
+ && php composer-setup.php --install-dir=/usr/local/bin --filename=composer \
+ && rm composer-setup.php \
+ && composer install --no-dev --classmap-authoritative --no-interaction --prefer-dist
 
 # moodledata (Railway volume mounts here)
 RUN mkdir -p /var/www/moodledata \
  && chown -R www-data:www-data /var/www/html /var/www/moodledata
 
-# Apache vhost: serve ONLY /public (Moodle 5.1+ requirement) and set ServerName
+# Apache vhost: serve ONLY /public (Moodle 5.x requirement) and set ServerName
 RUN printf '%s\n' \
     '<VirtualHost *:80>' \
     '    ServerName localhost' \
@@ -59,8 +60,6 @@ RUN printf '%s\n' \
     > /etc/apache2/sites-available/000-default.conf
 
 # Router + PHP max_input_vars via .htaccess in /public
-# - FallbackResource /r.php satisfies the Router check
-# - php_value max_input_vars 5000 satisfies the env check
 RUN printf '%s\n' \
     'php_value max_input_vars 5000' \
     'FallbackResource /r.php' \
-- 
2.48.1.windows.1

